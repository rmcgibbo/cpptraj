os: Windows Server 2012

install:
  - set MSYSTEM=MINGW64
  - "SET PATH=C:\\msys64\\usr\\bin\\;C:\\msys64\\mingw64\\bin;%PATH%"
  - "sh -lc \"pacman -S --noconfirm --needed
      mingw-w64-x86_64-openblas
      mingw-w64-x86_64-arpack
      mingw-w64-x86_64-gcc-fortran
      mingw-w64-x86_64-ncurses
      mingw-w64-x86_64-readline
    \""
  - gcc --version


  - curl -fsS -o netcdf-4.3.3.zip ftp://ftp.unidata.ucar.edu/pub/netcdf/netcdf-4.3.3.zip
  - 7z x netcdf-4.3.3.zip -o%APPVEYOR_BUILD_FOLDER% > nul

  - "sh -lc \"exec 0</dev/null &&
      cd $APPVEYOR_BUILD_FOLDER/netcdf-4.3.3 &&
      ./configure --enable-static --disable-netcdf-4 --prefix=/mingw64 &&
      make install
    \""

  - echo CPPTRAJBIN=%APPVEYOR_BUILD_FOLDER%/bin > config.h
  - echo 'DBGFLAGS= ' >> config.h
  - echo 'CC=gcc ' >> config.h
  - echo 'CXX=g++ ' >> config.h
  - echo 'FC=gfortran ' >> config.h
  - echo 'CFLAGS= -O3 -Wall -DHASBZ2 -DHASGZ -DBINTRAJ -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64  -I/usr/local/include -I/mingw64/include -I/mingw64/include/readline $(DBGFLAGS) ' >> config.h
  - echo 'CXXFLAGS= -O3 -Wall -DHASBZ2 -DHASGZ -DBINTRAJ -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64  -I/usr/local/include -I/mingw64/include  -I/mingw64/include/readline $(DBGFLAGS) ' >> config.h
  - echo 'FFLAGS= -O3 -DHASBZ2 -DHASGZ -DBINTRAJ -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64  -I/usr/local/include -I/mingw64/include  -I/mingw64/include/readline/ -ffree-form $(DBGFLAGS) ' >> config.h
  - echo 'READLINE= ' >> config.h
  - echo 'READLINE_HOME=/mingw64/lib/ ' >> config.h
  - echo 'READLINE_TARGET=/mingw64/lib/libreadline.a ' >> config.h
  - echo 'LIBCPPTRAJ=nolibcpptraj ' >> config.h
  - echo 'FFT_DEPEND=pub_fft.o ' >> config.h
  - echo 'FFT_LIB=pub_fft.o ' >> config.h
  - echo 'LDFLAGS= -lreadline -lncurses -larpack -lnetcdf -lopenblas -lbz2 -lz  -lgfortran -lquadmath -w  -static ' >> config.h
  - echo 'SFX=.exe ' >> config.h

build_script:
  - bash -lc "cat config.h"
  - bash -lc "make"
